<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>App01 ジェスチャーゲーム | 飲み会Webアプリ</title>
  <meta name="description" content="身振り手振りだけでお題を伝える定番飲み会アプリ。操作しやすいUI＆AdSense対応版。">
  <meta name="google-adsense-account" content="ca-pub-1643561503893272">
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1643561503893272" crossorigin="anonymous"></script>
</head>
<body>
  <header>
    <img src="/images/logo.png" alt="ロゴ" class="logo" />
    <p class="ad-label">スポンサーリンク</p>
    <div class="ad-box">
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1643561503893272" data-ad-slot="1111111111" data-ad-format="auto" data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
  </header>

  <main class="card">
    <h1>ジェスチャーゲーム</h1>
    <p>身振り手振りだけでお題を伝えよう！</p>
    <button onclick="goToStep(1)">▶ ゲームをはじめる</button>
  </main>

  <section id="step1" class="card step hidden">
    <h2>プレイヤー・観客登録</h2>

    <div id="players"></div>
    <button onclick="addPlayer()">＋ プレイヤー追加</button>

    <div id="spectators"></div>
    <button onclick="addSpectator()">＋ 観客追加</button>

    <label>ジャンル:</label>
    <select id="category">
      <option value="animals">動物</option>
      <option value="jobs">職業</option>
      <option value="actions">アクション</option>
      <option value="hard">難問</option>
    </select>

    <label>チーム分け:</label>
    <select id="teamMethod">
      <option value="solo">個人戦</option>
      <option value="random">ランダム</option>
      <option value="manual">手動</option>
    </select>

    <label>ラウンド数:</label>
    <input type="number" id="rounds" value="3" min="1" />

    <label>BGM選択:</label>
    <select id="bgmSelect">
      <option value="none">なし</option>
      <option value="cafe">カフェ</option>
      <option value="anime">アニメ</option>
      <option value="party">パーティー</option>
    </select>
    <audio id="bgm" loop autoplay></audio>

    <button onclick="startGame()">ゲーム開始</button>
  </section>

  <section id="gameArea" class="card step hidden">
    <h2 id="gamePrompt">🎬 お題はこちら！</h2>
    <p id="currentPlayerDisplay"></p>
    <p id="nextPlayerDisplay"></p>
    <p id="currentTeamDisplay"></p>
    <div id="topicDisplay">---</div>
    <p id="bonusDisplay"></p>
    <p id="missionDisplay"></p>
    <p id="timer">残り：-- 秒</p>
    <div id="scoreInput"></div>
    <div class="ad-box">
      <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1643561503893272" data-ad-slot="2222222222" data-ad-format="auto" data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
    <button onclick="submitScore()">スコア送信</button>
  </section>

  <section id="result" class="card step hidden">
    <h2>🎉 結果発表 🎉</h2>
    <ul id="scoreList"></ul>
    <p id="mvp"></p>
    <button onclick="saveResultImage()">📷 結果を画像保存</button>
    <button onclick="location.reload()">タイトルに戻る</button>
  </section>

  <section class="card">
    <button onclick="saveResultImage()">📷 画像保存</button>
    <div class="share-buttons">
      <a id="shareX" href="#" target="_blank"><img src="/images/icons/x_logo.png" class="icon" alt="X"></a>
      <a id="shareLINE" href="#" target="_blank"><img src="/images/icons/line_logo.png" class="icon" alt="LINE"></a>
    </div>
  </section>

  <div class="ad-box">
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1643561503893272" data-ad-slot="3333333333" data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>

  <footer>
    <img src="/images/qrcode.png" class="qr" alt="QRコード" />
    <p><a href="/index.html">ポータルに戻る</a> ｜ <a href="/terms.html">利用規約</a> ｜ <a href="/privacy.html">プライバシーポリシー</a></p>
    <p>&copy; 2025 飲み会アプリプロジェクト</p>
  </footer>

  <!-- ✅ 修正済：先に script.js を読み込む -->
  <script src="script.js"></script>

  <!-- ✅ 後から onload 実行関数を定義 -->
  <script>
    function goToStep(stepId) {
      document.querySelectorAll(".step").forEach(s => s.classList.add("hidden"));
      const target = typeof stepId === "number" ? `step${stepId}` : stepId;
      document.getElementById(target)?.classList.remove("hidden");
    }

    window.onload = () => {
      addPlayer();
      addPlayer();
      addSpectator();
      goToStep(1); // 初期表示セクション
      updateShareLinks();
    };
  </script>
</body>
</html>
